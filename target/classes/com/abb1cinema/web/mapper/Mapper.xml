<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.abb1cinema.web.mapper.Mapper">
<insert id="registerCustomer">
INSERT INTO Customer(id, pw, name, gender, birth, phone, email, point) VALUES (#{id},#{pw},#{name},#{gender},#{birth},#{phone},#{email},'0');
</insert>

<select id="findCustomer" resultType="com.abb1cinema.web.domain.Customer" parameterType="hashMap">
SELECT * FROM Customer WHERE id = #{id}
</select>

<select id="existCustomer" resultType="int" parameterType="hashMap">
SELECT COUNT(*) FROM Customer WHERE id=#{id}
</select>

<update id="updateCustomer">
UPDATE Customer
<set>
	<if test="pw != null"> pw=#{pw}, </if>
	<if test="phone != null"> phone=#{phone}, </if>
	<if test="address != null"> email=#{email} </if>
</set>
WHERE id=#{id};
</update>
<update id="updateArticle">
UPDATE Article 
SET article_type = #{article_type}, 
title = #{title}, 
content = #{content},
file = #{file}
WHERE seq = ${seq}
</update>

<delete id="deleteCustomer" parameterType="hashMap">
DELETE FROM Customer WHERE id = #{id}
</delete>

<select id="getReservationList" resultType="com.abb1cinema.web.domain.Reservation" parameterType="hashMap">
SELECT * FROM Reservation WHERE customer_id=#{id}
</select>

<!-- john -->
   <select id="getMovieList" resultType="com.abb1cinema.web.domain.Movie" parameterType="hashMap">
   SELECT * FROM Movie;
   </select>
   <select id="getReviewList" resultType="com.abb1cinema.web.domain.Review" parameterType="hashMap">
   SELECT * FROM Review ORDER BY seq DESC;
   </select>
   <select id="getArticleList" resultType="com.abb1cinema.web.domain.Article" parameterType="hashMap">
   SELECT * FROM Article 
      <if test="title != null">
      WHERE title like '%${title}%' 
      </if>
      <if test="content != null">
      WHERE content like '%${content}%' 
      </if>
      <if test="both != null">
      WHERE title like '%${both}%' OR content like '%${both}%' 
      </if>
   ORDER BY seq DESC;
   </select>
   <select id="getArticle" resultType="com.abb1cinema.web.domain.Article" parameterType="hashMap">
   SELECT * FROM Article WHERE seq = #{seq};
   </select>
   <select id="getNoticeList" resultType="com.abb1cinema.web.domain.Notice" parameterType="hashMap">
   SELECT * FROM Notice ORDER BY seq DESC;
   </select>
   <select id="getNotice" resultType="com.abb1cinema.web.domain.Notice" parameterType="hashMap">
   SELECT * FROM Notice WHERE seq = #{seq};
   </select>
   <select id="getCommentList" resultType="com.abb1cinema.web.domain.Comment" parameterType="hashMap">
   SELECT * FROM Comment WHERE article_seq = #{seq} ORDER BY reg_date DESC;
   </select>
   <select id="getMultiplexList" resultType="com.abb1cinema.web.domain.Multiplex" parameterType="hashMap">
   SELECT * FROM Multiplex;
   </select>
   <select id="getTheaterList" resultType="com.abb1cinema.web.domain.Theater" parameterType="hashMap">
   SELECT * FROM Theater
      <if test="key != null">
      WHERE multiplex_seq = ${seq};
      </if>
   </select>
   <select id="getInfoList" resultType="com.abb1cinema.web.domain.Information" parameterType="hashMap">
   SELECT * FROM Information 
   <if test="key1 != null">
   WHERE ${key1}=#{value1} 
   </if>
   <if test="key2 != null">
   AND ${key2}=#{value2} 
   </if>
   <if test="key3 != null">
   AND ${key3}=#{value3}
   </if>
   <if test="orderBy != null">
   ORDER BY ${orderBy}
   </if>
   </select>
   
   
   <!-- other -->
   <select id="count" resultType="int" parameterType="hashMap">
      SELECT COUNT(*) FROM ${group}
      <if test="key != null">
      WHERE ${key} = #{value};
      </if>
   </select>
   <select id="exist" resultType="int" parameterType="hashMap">
      SELECT COUNT(*) FROM ${group} WHERE ${idType} = #{id}
   </select>
   <delete id="delete" parameterType="hashMap">
      DELETE FROM ${group} WHERE ${key} = #{value}
   </delete>
   
   <update id="updateReservation">
	UPDATE Reservation set canceled = 'Y' WHERE id = #{id}
	</update>
	
	<select id="getShowingList" resultType="com.abb1cinema.web.domain.Showing" parameterType="hashMap">
   SELECT * FROM Showing;
   </select>
   <select id="getTimetableList" resultType="com.abb1cinema.web.domain.Timetable" parameterType="hashMap">
   SELECT * FROM Timetable;
   </select>
   
   
   <select id="getDistinctShowingList" resultType="com.abb1cinema.web.domain.Showing" parameterType="hashMap">
   SELECT DISTINCT ${column1}
   <if test="column2 != null">
   , ${column2}
   </if>
    FROM Showing;
   </select>
   
   
   <!-- 2017-05-23 -->
   <select id="getCustomerFindList" resultType="com.abb1cinema.web.domain.Customer" parameterType="hashMap">
   SELECT id,pw,name,email FROM Customer;
   </select>
   
   <!-- 2017-05-24 -->
   <insert id="postReservation">
	INSERT INTO Reservation(id, reg_date, canceled, price, hcount, customer_id, showing_seq) 
	VALUES (#{id},#{reg_date},#{canceled},#{price},#{hcount},#{customer_id},#{showing_seq});
	</insert>
	<insert id="writeArticle">
	INSERT INTO Article(article_type, title, content, file, reg_date, hits, customer_id, multiplex_seq) 
	VALUES (#{article_type},#{title},#{content},#{file},#{reg_date},#{hits},#{customer_id},#{multiplex_seq});
	</insert>
	<insert id="writeComment">
	INSERT INTO Comment(reg_date, content, customer_id, article_seq) 
	VALUES (#{reg_date},#{content},#{customer_id},#{article_seq});
	</insert>
	
	<select id="findCustomerByName" resultType="com.abb1cinema.web.domain.Customer" parameterType="hashMap">
	SELECT * FROM Customer WHERE name = #{name} AND email = #{email}
	</select>
	<select id="findCustomerById" resultType="com.abb1cinema.web.domain.Customer" parameterType="hashMap">
	SELECT * FROM Customer WHERE id = #{id} AND email = #{email}
	</select>
	
	<select id="existCustomerByName" resultType="int" parameterType="hashMap">
	SELECT COUNT(*) FROM Customer WHERE name=#{name} AND email=#{email}
	</select>
	<select id="existCustomerById" resultType="int" parameterType="hashMap">
	SELECT COUNT(*) FROM Customer WHERE id=#{id} AND email=#{email}
	</select>
	
	<update id="updateHits">
	UPDATE ${group}
	<set>
		<if test="hits != null"> hits=#{hits} </if>
	</set>
	WHERE seq=#{seq};
	</update>
	
	<select id="countSome" resultType="int" parameterType="hashMap">
      SELECT COUNT(*) FROM ${group}
      <if test="key1 != null">
      WHERE ${key1} like '%${value1}%'
      </if>
      <if test="key2 != null">
      WHERE ${key2} like '%${value2}%' OR ${key3} like '%${value3}%'
      </if>
   </select>
   
   <select id="getAdminReservationList" resultType="com.abb1cinema.web.domain.Information" parameterType="hashMap">
   SELECT * FROM Information WHERE ${key} LIKE '%${value}%' AND resCanceled=#{canceled}
   </select>
   
   <select id="getAdminShowList" resultType="com.abb1cinema.web.domain.Timetable" parameterType="hashMap">
   SELECT * FROM Timetable WHERE ${key} LIKE '%${value}%'
   </select>
   
   <select id="getMovieDetail" resultType="com.abb1cinema.web.domain.Movie" parameterType="hashMap">
   SELECT * FROM Movie WHERE title LIKE '%${value}%'
   </select>
   
   <update id="updateAdminMovie">
   UPDATE Movie 
   SET 
   title=#{title},
   grade=#{grade},
   released=#{released},
   info=#{info},
   synopsys=#{synopsys},
   name_director=#{name_director},
   name_actor=#{name_actor},
   trailer_url=#{trailer_url} 
   WHERE seq=${seq}
   </update>
   
   <select id="checkMovieTitle" resultType="int" parameterType="hashMap">
   SELECT COUNT(*) FROM Movie WHERE title LIKE '%${value}%'
   </select>
   
   
   <!-- 추가 -->
   <insert id="registerMovie" parameterType="hashMap">
	INSERT INTO Movie(title, count, grade,released, info, synopsys, male_p,female_p, trailer_url,trailer_main,pic_main, pic_director, name_director, pic_actor, name_actor) VALUES (#{title},'0',#{grade},#{released},#{info},#{synopsys},'0','0',#{trailer_url},#{trailer_main},#{pic_main},#{pic_director},#{name_director},#{pic_actor},#{name_actor})
	</insert>
	
   <update id="updateMainMovie">
   UPDATE Movie SET trailer_main=#{value1} WHERE ${key}=#{value2}
   </update>
   
   <select id="findMovieSeq" resultType="int" parameterType="hashMap">
   SELECT COUNT(*) FROM Movie WHERE seq=#{seq}
   </select>
   
</mapper>